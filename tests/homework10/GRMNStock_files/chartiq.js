CIQ.Tooltip2=function(tooltipParams){var stx=tooltipParams.stx;var showOhl=tooltipParams.ohl;var showChange=tooltipParams.change;var showVolume=tooltipParams.volume;var showSeries=tooltipParams.series;var showStudies=tooltipParams.studies;var showOverBarOnly=tooltipParams.showOverBarOnly;var node=$(stx.chart.container).find("stx-hu-tooltip")[0];if(!node){node=$("<stx-hu-tooltip></stx-hu-tooltip>").appendTo($(stx.chart.container))[0]}CIQ.Marker.Tooltip=function(params){if(!this.className)this.className="CIQ.Marker.Tooltip";params.label="tooltip";CIQ.Marker.call(this,params)};CIQ.Marker.Tooltip.ciqInheritsFrom(CIQ.Marker,false);CIQ.Marker.Tooltip.sameBar=function(bar1,bar2){if(!bar1||!bar2)return false;if(+bar1.DT!=+bar2.DT)return false;if(bar1.Close!=bar2.Close)return false;if(bar1.Open!=bar2.Open)return false;if(bar1.Volume!=bar2.Volume)return false;return true};CIQ.Marker.Tooltip.placementFunction=function(params){if(!CIQ.showTooltip)return;var offset=30;var stx=params.stx;for(var i=0;i<params.arr.length;i++){var marker=params.arr[i];var bar=stx.barFromPixel(stx.cx);var quote=stx.chart.dataSegment[bar];var goodBar;var overBar=true;var highPx,lowPx;if(quote!="undefined"&&quote&&quote.DT){goodBar=true;if(quote.High)highPx=stx.pixelFromPrice(quote.High);if(quote.Low)lowPx=stx.pixelFromPrice(quote.Low);if(!stx.highLowBars[stx.layout.chartType]){if(quote.Close){highPx=stx.pixelFromPrice(quote.Close)-15;lowPx=stx.pixelFromPrice(quote.Close)+15}}if(showOverBarOnly&&!(stx.cy>=highPx&&stx.cy<=lowPx))overBar=false}if(!(CIQ.ChartEngine.insideChart&&stx.layout.crosshair&&stx.displayCrosshairs&&!stx.openDialog&&!stx.activeDrawing&&!stx.grabbingScreen&&goodBar&&overBar)){marker.node.style.left="-50000px";marker.node.style.right="auto";marker.lastBar={};return}if(CIQ.Marker.Tooltip.sameBar(stx.chart.dataSegment[bar],marker.lastBar)&&bar!=stx.chart.dataSegment.length-1)return;marker.lastBar=stx.chart.dataSegment[bar];var cw=marker.lastBar.candleWidth||stx.layout.candleWidth;if(parseInt(getComputedStyle(marker.node).width,10)+stx.chart.panel.left+offset+cw<stx.backOutX(CIQ.ChartEngine.crosshairX)){marker.node.style.left="auto";marker.node.style.right=Math.round(stx.container.clientWidth-stx.pixelFromBar(bar)+offset)+"px"}else{marker.node.style.left=Math.round(stx.pixelFromBar(bar)+offset)+"px";marker.node.style.right="auto"}marker.node.style.top=Math.round(CIQ.ChartEngine.crosshairY-stx.top-parseInt(getComputedStyle(marker.node).height,10)/2)+"px"}var overXAxis=stx.overXAxis,overYAxis=stx.overYAxis;stx.overXAxis=stx.overYAxis=false;stx.doDisplayCrosshairs();stx.overXAxis=overXAxis;stx.overYAxis=overYAxis};function renderFunction(){if(!this.huTooltip||!CIQ.showTooltip)return;if((stx.controls.crossX&&stx.controls.crossX.style.display=="none")||(stx.controls.crossY&&stx.controls.crossY.style.display=="none"))return;var bar=this.barFromPixel(this.cx),data=this.chart.dataSegment[bar];if(!data){this.positionMarkers();return}if(CIQ.Marker.Tooltip.sameBar(data,this.huTooltip.lastBar)&&bar!=this.chart.dataSegment.length-1)return;var node=$(this.huTooltip.node);node.find("[auto]").remove();node.find("stx-hu-tooltip-field-value").html();var panel=this.chart.panel;var yAxis=panel.yAxis;var dupMap={};var fields=[];fields.push({member:"DT",display:"DT",panel:panel,yAxis:yAxis});fields.push({member:"Close",display:"Close",panel:panel,yAxis:yAxis});dupMap.DT=dupMap.Close=1;if(showChange&&CIQ.ChartEngine.isDailyInterval(this.layout.interval)){fields.push({member:"Change",display:"Change",panel:panel,yAxis:yAxis})}if(showOhl){fields.push({member:"Open",display:"Open",panel:panel,yAxis:yAxis});fields.push({member:"High",display:"High",panel:panel,yAxis:yAxis});fields.push({member:"Low",display:"Low",panel:panel,yAxis:yAxis});dupMap.Open=dupMap.High=dupMap.Low=1}if(showVolume){fields.push({member:"Volume",display:"Volume",panel:null,yAxis:null});dupMap.Volume=1}if(showSeries){var renderers=this.chart.seriesRenderers;for(var renderer in renderers){var rendererToDisplay=renderers[renderer];if(rendererToDisplay===this.mainSeriesRenderer)continue;panel=this.panels[rendererToDisplay.params.panel];yAxis=rendererToDisplay.params.yAxis;if(!yAxis&&rendererToDisplay.params.shareYAxis)yAxis=panel.yAxis;for(var id=0;id<rendererToDisplay.seriesParams.length;id++){var seriesParams=rendererToDisplay.seriesParams[id];var sKey=seriesParams.symbol;var subField=seriesParams.field;if(!sKey)sKey=subField;else if(subField&&sKey!=subField)sKey=CIQ.createObjectChainNames(sKey,subField)[0];var display=seriesParams.display||seriesParams.symbol||seriesParams.field;if(sKey&&!dupMap[display]){fields.push({member:sKey,display:display,panel:panel,yAxis:yAxis});dupMap[display]=1}}}}if(showStudies){for(var study in this.layout.studies){panel=this.panels[this.layout.studies[study].panel];yAxis=panel.yAxis;for(var output in this.layout.studies[study].outputMap){if(output&&!dupMap[output]){fields.push({member:output,display:output,panel:panel,yAxis:yAxis});dupMap[output]=1}}if(!dupMap[study+"_hist"]){fields.push({member:study+"_hist",display:study+"_hist",panel:panel,yAxis:yAxis});fields.push({member:study+"_hist1",display:study+"_hist1",panel:panel,yAxis:yAxis});fields.push({member:study+"_hist2",display:study+"_hist2",panel:panel,yAxis:yAxis});dupMap[study+"_hist"]=1}}}for(var f=0;f<fields.length;f++){var obj=fields[f];var name=obj.member;var displayName=obj.display;panel=obj.panel;yAxis=obj.yAxis;var labelDecimalPlaces=null;if(yAxis){if(panel!==panel.chart.panel){if(yAxis.decimalPlaces||yAxis.decimalPlaces===0)labelDecimalPlaces=yAxis.decimalPlaces;else if(yAxis.maxDecimalPlaces||yAxis.maxDecimalPlaces===0)labelDecimalPlaces=yAxis.maxDecimalPlaces}else{labelDecimalPlaces=Math.max(yAxis.printDecimalPlaces,panel.chart.decimalPlaces);if(yAxis.maxDecimalPlaces||yAxis.maxDecimalPlaces===0)labelDecimalPlaces=Math.min(labelDecimalPlaces,yAxis.maxDecimalPlaces)}}var dsField=null;var tuple=CIQ.existsInObjectChain(data,name);if(tuple)dsField=tuple.obj[tuple.member];else if(name=="Change")dsField=data.Close-data.iqPrevClose;var fieldName=displayName.replace(/^(Result )(.*)/,"$2");if((dsField||dsField===0)&&(name=="DT"||typeof dsField!=="object"||dsField.Close||dsField.Close===0)){var fieldValue="";if(dsField.Close||dsField.Close===0)dsField=dsField.Close;if(dsField.constructor==Number){if(!yAxis){fieldValue=dsField}else if(yAxis.originalPriceFormatter&&yAxis.originalPriceFormatter.func){fieldValue=yAxis.originalPriceFormatter.func(this,panel,dsField,labelDecimalPlaces)}else if(yAxis.priceFormatter&&yAxis.priceFormatter!=CIQ.Comparison.priceFormat){fieldValue=yAxis.priceFormatter(this,panel,dsField,labelDecimalPlaces)}else{fieldValue=this.formatYAxisPrice(dsField,panel,labelDecimalPlaces,yAxis)}}else if(dsField.constructor==Date){if(name=="DT"&&this.controls.floatDate&&this.controls.floatDate.innerHTML){if(this.chart.xAxis.noDraw)fieldValue="N/A";else fieldValue=this.controls.floatDate.innerHTML}else{fieldValue=CIQ.yyyymmdd(dsField);if(!CIQ.ChartEngine.isDailyInterval(this.layout.interval)){fieldValue+=" "+dsField.toTimeString().substr(0,8)}}}else{fieldValue=dsField}var dedicatedField=node.find('stx-hu-tooltip-field[field="'+fieldName+'"]');if(dedicatedField.length){dedicatedField.find("stx-hu-tooltip-field-value").html(fieldValue);var fieldNameField=dedicatedField.find("stx-hu-tooltip-field-name");if(fieldNameField.html()==="")fieldNameField.html(this.translateIf(fieldName))}else{fieldName=fieldName.replace("Bollinger Bands ",'');if(fieldName.toLowerCase().indexOf("momentum")>-1){fieldName="Momentum"}else if(fieldName.toLowerCase().indexOf("ma ")>-1){fieldName="Moving Average (50d)"}else if(fieldName.toLowerCase().includes("_hist")){fieldName="MACD Histogram"}else if(fieldName.toLowerCase().includes("_hist")){fieldName="MACD Histogram"}else if(fieldName.toLowerCase().includes("signal ")){fieldName="MACD Signal Line"}else if(fieldName.toLowerCase().includes("macd ")){fieldName="MACD"}else if(fieldName.toLowerCase().includes("%k")){fieldName="Stochastics %K"}else if(fieldName.toLowerCase().includes("%d")){fieldName="Stochastics %D"}else if(fieldName.toLowerCase().includes("rsi")){fieldName="RSI"}else if(fieldName.includes("Top ")){fieldName="Top Bollinger Bands"}else if(fieldName.includes("Median ")){fieldName="Median Bollinger Bands"}else if(fieldName.includes("Bottom ")){fieldName="Bottom Bollinger Bands"}else if(fieldName.includes("Trend ")){fieldName="Supertrend"}else if(fieldName.includes("ATR ")){fieldName="Average True Range"}$("<stx-hu-tooltip-field auto></stx-hu-tooltip-field>").append($("<stx-hu-tooltip-field-name>"+this.translateIf(fieldName)+"</stx-hu-tooltip-field-name>")).append($("<stx-hu-tooltip-field-value>"+fieldValue+"</stx-hu-tooltip-field-value>")).appendTo(node)}}else{var naField=node.find('stx-hu-tooltip-field[field="'+fieldName+'"]');if(naField.length){var naFieldNameField=naField.find("stx-hu-tooltip-field-name");if(naFieldNameField.html()!=="")naField.find("stx-hu-tooltip-field-value").html("n/a")}}}this.huTooltip.render()}CIQ.ChartEngine.prototype.append("undisplayCrosshairs",function(){var tt=this.huTooltip;if(tt&&tt.node){var node=$(tt.node);if(node&&node[0]){node[0].style.left="-50000px";node[0].style.right="auto";tt.lastBar={}}}});CIQ.ChartEngine.prototype.append("deleteHighlighted",function(){this.huTooltip.lastBar={};this.headsUpHR()});CIQ.ChartEngine.prototype.append("headsUpHR",renderFunction);CIQ.ChartEngine.prototype.append("createDataSegment",renderFunction);stx.huTooltip=new CIQ.Marker.Tooltip({stx:stx,xPositioner:"bar",chartContainer:true,node:node})}